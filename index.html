<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./styles/home.css"  charset="utf-8">
        <script>
          var loggedUser = "";
            function loginAuth()
            {   
                var xmlFile = 'accounts.xml';
                var xmlDoc, parser, xmlU, xmlP;
                parser = new DOMParser();
                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", xmlFile, true);
                xhttp.send();
                xhttp.onreadystatechange = function() {
                  if (this.readyState === 4 && this.status === 200) 
                    {      
                        console.log(xhttp.responseText);
                        credentialAuth(this);
                    }
                }
            }
            function credentialAuth(xml)
            {
              var u = document.getElementById('username').value;
              var p = document.getElementById('password').value;
              console.log("P" + p, " U: " + u);
              var xmlDoc = xml.responseXML;
              var x = xmlDoc.documentElement;
              var y = xmlDoc.documentElement.childNodes;
              var txt = " "; 
              var z;
              for (i = 0; i < y.length ;i++) 
              { 
                for(z = 0; z < y[i].childNodes.length; z++)
                {
                  if (y[i].childNodes[z].nodeType != 3) 
                  {
                    txt += "Node " + i + " Nodename: " + y[i].childNodes[z].nodeName +
                    " (value at index " + z+ ": " + y[i].childNodes[z].childNodes[0].nodeValue + ")";
                    console.log(txt);
                    txt = "";
                    var a =  y[i].childNodes[1].childNodes[0].nodeValue
                    var b =  y[i].childNodes[3].childNodes[0].nodeValue
                    if ( a == u && b == p)
                    { 
                      document.getElementById("loginBtn").style.display="none";
                      document.getElementById("login").style.display= "none";
                      alert("Login successful. Welcome " + a);
                      loggedUser = a;
                      checkLoginStatus();
                      break;
                    }
                  }
                }     
              }
            }
            function checkLoginStatus()
            {
              if(loggedUser == "")
              { 
                document.getElementById("signoutBtn").style.display = "none";
                alert("Please Login")
                document.getElementById("login").style.display= "block";
              }
              if(loggedUser !="")
              {
                document.getElementById("signoutBtn").style.display = "inline";
              }
            }
            function logout()
            {
              loggedUser = "";
              document.getElementById("loginBtn").style.display = "inline";
              document.getElementById("signoutBtn").style.display = "none";
            }
            function loadLoginForm()
            {
              document.getElementById('login').style.display="block";
              document.getElementById('login').style.style="width:auto";
            }
            function helpPass()
            {
              alert("Message Dichroic on Discord");
            }
            function openCity(evt, cityName) 
            {
              var i, tabcontent, tablinks;
              tabcontent = document.getElementsByClassName("tabcontent");
              for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
              }
              tablinks = document.getElementsByClassName("tablinks");
              for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
              }
              document.getElementById(cityName).style.display = "block";
              evt.currentTarget.className += " active";
            }
            function gachaDropDownNav()
            {

            }
            function openNav(evt, tabName)
            { 
              console.log("Trying func");
              var i, tabcontent, tablinks;
              tabcontent = document.getElementsByClassName("tabcontent");
              for (i = 0; i < tabcontent.length; i++) 
              {
                tabcontent[i].style.display = "none";
              }
              tablinks = document.getElementsByClassName("tablinks");
              for (i = 0; i < tablinks.length; i++) 
              {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
              }
              document.getElementById(tabName).style.display = "block";
              evt.currentTarget.className += " active";
            }
        </script>
        </head>
    <body onload="checkLoginStatus()">
        <title>GBF Buddy Homepage</title>
        <h1>Homepage</h1>
        <div class="menuNavBar">
            <button class="tablinks" onclick="openNav(event, 'GachaLog')">Gacha Log</button>
            <button class="tablinks">GW Teams</button>  
            <button class="tablinks" onclick="loadLoginForm()" id="loginBtn">Login</button>
            <button class="tablinks" id="signoutBtn" style.display='none' onclick="logout()">Log out</button>
        </div>
        <p id="debug">Test debugger</p>
        <div id="login" class="modal">
            <form class="modal-content animate">
              <div class="imgcontainer">
                <span onclick="document.getElementById('login').style.display='none'" class="close" title="Close Modal">&times;</span>
                <img src="./assests/loginIcon.png" alt="Avatar" class="avatar">
              </div>
              <div class="container">
                <label for="uname"><b>Username</b></label>
                <input type="text" placeholder="Enter Username" name="uname" id="username" required>
          
                <label for="psw"><b>Password</b></label>
                <input type="password" placeholder="Enter Password" name="psw" id="password" required>
                  
                <button type="button" class="loginButton" onclick="loginAuth()">Login</button>
                <label>
                  <input type="checkbox" checked="checked" name="remember"> Remember me
                </label>
              </div>
              <div class="container" style="background-color:#f1f1f1">
                <button type="button" onclick="document.getElementById('login').style.display='none'" class="cancelbtn">Cancel</button>
                <span class="psw">Forgot <a href="#" onclick="helpPass()">password?</a></span>
              </div>
            </form>
        </div>
        <div class="tabVerContent" id="GachaLog">
          <div class="menuVertNavBar">
            <button class="tablinksVert">Add Data</button>
            <button class="tablinksVert">View Data</button>  
        </div>
          <div class="dropdownGacha" id="dropdownGacha">
            <button onclick="gachaDropDownNav()" class="dropbtn">Dropdown</button>
            <div id="gachaDrop" class="dropdown-content">
              <a href="#">Link 1</a>
              <a href="#">Link 2</a>
              <a href="#">Link 3</a>
            </div>
          </div>
        </div>  
    </body>
</html>
